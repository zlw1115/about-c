**union结构**

有时需要一种数据结构，不同场合表示不同的数据类型。C语言提供了Union结构，用来自定义可以灵活变更的数据结构。它内部包含各种属性，但是所有属性共用一块内存，导致这些属性都是对同一个二进制数据的解读，其中往往只有一个属性的解读是有意义的。并且，后面写入的属性会覆盖前面的属性，这意味着同一块内存，可以先供某一个属性使用，然后再供另一个属性使用。这样做的最大好处就是节省内存空间。

```
union quantiry{
  short count;
  float weight;
  float volume;
}
```

union命令定义了一个包含三个属性的数据类型quantity。虽然包含三个属性，但是只能写入一个值，三个属性都是对这个值得不同解读。最后赋值的属性，往往就是可以取到有意义的值得那个属性。

```
// 写法一
union quantity q;
q.count = 4;

// 写法二
union quantity q = {.count=4};

// 写法三
union quantity q = {4}; // 不指定属性名，默认赋值给第一个属性
```

执行完上面的代码以后，q.count可以取到值，另外两个属性取不到值。

```
printf("count is %i\n", q.count);
printf("weight is %f\n", q.weight); // 未定义行为
```

如果要让q.weight属性可以取到值，就要先为它赋值。

```
q.weight = 0.5;
printf("weight is %f\n", q.weight);
```

一旦为其他属性赋值，原先可以取到值的q.count属性就跟着改变，使用它可能就没有意义了。除了这一点，Union结构的其他用法与Struct结构，基本一致。

Union结构也支持指针运算符->。

union结构的好处，主要是节省空间。它将一段内存空间，重用于不同类型的数据。定义了三个属性，但同一时间只用到一个，使用union结构就可以节省另外两个属性的空间。union结构占用的内存长度，等于它内部最长属性的长度。



















